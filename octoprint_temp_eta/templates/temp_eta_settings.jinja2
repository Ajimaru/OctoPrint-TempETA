<form id="settings_plugin_temp_eta" class="form-horizontal temp-eta-settings">
    <fieldset>
        <legend>{{ _('Temperature ETA Settings') }}</legend>

        <ul class="nav nav-tabs" id="temp_eta_settings_tabs">
            <li class="active"><a href="#temp_eta_settings_tab_basic" data-toggle="tab">{{ _('Basic Settings') }}</a></li>
            <li><a href="#temp_eta_settings_tab_display" data-toggle="tab">{{ _('Display') }}</a></li>
            <li><a href="#temp_eta_settings_tab_cooldown" data-toggle="tab">{{ _('Cool-down ETA') }}</a></li>
            <li><a href="#temp_eta_settings_tab_advanced" data-toggle="tab">{{ _('Advanced Settings') }}</a></li>
            <li><a href="#temp_eta_settings_tab_maintenance" data-toggle="tab">{{ _('Maintenance') }}</a></li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane active" id="temp_eta_settings_tab_basic">

        <!-- Enable/Disable Plugin -->
        <div class="control-group">
            <label class="control-label" for="temp_eta_enabled">{{ _('Enable Temperature ETA') }}</label>
            <div class="controls">
                <input type="checkbox" id="temp_eta_enabled" data-bind="checked: settings.plugins.temp_eta.enabled">
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="temp_eta_suppress_while_printing">{{ _('Hide ETA while printing') }}</label>
            <div class="controls">
                <input type="checkbox" id="temp_eta_suppress_while_printing"
                       data-bind="checked: settings.plugins.temp_eta.suppress_while_printing, enable: settings.plugins.temp_eta.enabled">
                <p class="help-block">{{ _('If disabled: ETA is shown when the temperature difference to the target is at least the heating threshold. If enabled: ETA is only shown when no print job is active.') }}</p>
            </div>
        </div>

        <!-- Heating Threshold -->
        <div class="control-group">
            <label class="control-label" for="temp_eta_threshold">
                {{ _('Heating threshold') }} <span data-bind="text: thresholdUnitLabel"></span>
            </label>
            <div class="controls">
                <input type="number" class="input-small" id="temp_eta_threshold"
                       data-bind="value: thresholdStartDisplay, enable: settings.plugins.temp_eta.enabled"
                       min="1" max="50" step="0.5">
                <p class="help-block">{{ _('Start ETA when target is this many degrees away') }}</p>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="temp_eta_threshold_unit">{{ _('Threshold unit') }}</label>
            <div class="controls">
                <select class="input-xlarge" id="temp_eta_threshold_unit"
                        data-bind="value: settings.plugins.temp_eta.threshold_unit, enable: settings.plugins.temp_eta.enabled">
                    <option value="c">{{ _('Celsius (°C)') }}</option>
                    <option value="f">{{ _('Fahrenheit (°F)') }}</option>
                    <option value="octoprint">{{ _('Follow temperature display') }}</option>
                </select>
                <p class="help-block">{{ _('Internally, the calculation uses °C. If you choose °F here, the value will be converted automatically.') }}</p>
            </div>
        </div>

        <!-- Algorithm Selection -->
        <div class="control-group">
            <label class="control-label" for="temp_eta_algorithm">{{ _('Calculation Algorithm') }}</label>
            <div class="controls">
                <select class="input-xlarge" id="temp_eta_algorithm" data-bind="value: settings.plugins.temp_eta.algorithm">
                    <option value="linear">{{ _('Linear (default)') }}</option>
                    <option value="exponential">{{ _('Exponential') }}</option>
                </select>
                <p class="help-block">
                    {{ _('Linear: Assumes constant heating rate, simple and fast. Exponential: Accounts for thermal asymptotic behavior, more accurate.') }}
                </p>
            </div>
        </div>

            </div>

            <div class="tab-pane" id="temp_eta_settings_tab_display">

        <div class="control-group">
            <label class="control-label" for="temp_eta_show_in_sidebar">{{ _('Show in sidebar') }}</label>
            <div class="controls">
                <input type="checkbox" id="temp_eta_show_in_sidebar"
                       data-bind="checked: settings.plugins.temp_eta.show_in_sidebar, enable: settings.plugins.temp_eta.enabled">
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="temp_eta_show_in_navbar">{{ _('Show in navbar') }}</label>
            <div class="controls">
                <input type="checkbox" id="temp_eta_show_in_navbar"
                       data-bind="checked: settings.plugins.temp_eta.show_in_navbar, enable: settings.plugins.temp_eta.enabled">
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="temp_eta_show_in_tab">{{ _('Show in tab') }}</label>
            <div class="controls">
                <input type="checkbox" id="temp_eta_show_in_tab"
                       data-bind="checked: settings.plugins.temp_eta.show_in_tab, enable: settings.plugins.temp_eta.enabled">
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="temp_eta_show_progress_bars">{{ _('Show progress bars') }}</label>
            <div class="controls">
                <input type="checkbox" id="temp_eta_show_progress_bars"
                       data-bind="checked: settings.plugins.temp_eta.show_progress_bars, enable: settings.plugins.temp_eta.enabled">
                <p class="help-block">{{ _('Show heating progress bars in the sidebar and tab views.') }}</p>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="temp_eta_show_historical_graph">{{ _('Show historical graph') }}</label>
            <div class="controls">
                <input type="checkbox" id="temp_eta_show_historical_graph"
                       data-bind="checked: settings.plugins.temp_eta.show_historical_graph, enable: settings.plugins.temp_eta.enabled">
                <p class="help-block">{{ _('Show a small temperature history graph in the Temperature ETA tab.') }}</p>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="temp_eta_historical_graph_window_seconds">{{ _('Historical graph window (seconds)') }}</label>
            <div class="controls">
                <input type="number" class="input-small" id="temp_eta_historical_graph_window_seconds"
                       data-bind="value: settings.plugins.temp_eta.historical_graph_window_seconds, enable: settings.plugins.temp_eta.enabled && settings.plugins.temp_eta.show_historical_graph"
                       min="30" max="1800" step="10">
                <p class="help-block">{{ _('How many seconds of temperature history to display (per heater).') }}</p>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="temp_eta_temp_display">{{ _('Temperature display') }}</label>
            <div class="controls">
                <select class="input-xlarge" id="temp_eta_temp_display"
                        data-bind="value: settings.plugins.temp_eta.temp_display, enable: settings.plugins.temp_eta.enabled">
                    <option value="octoprint">{{ _('Use OctoPrint appearance setting') }}</option>
                    <option value="c">{{ _('Celsius (°C)') }}</option>
                    <option value="cf">{{ _('Celsius + Fahrenheit (°C/°F)') }}</option>
                </select>
                <p class="help-block">{{ _('Tip: In OctoPrint Settings → Appearance you can enable “Show temperatures in Fahrenheit as well as Celsius”. This plugin can also override that via the dropdown above.') }}</p>
            </div>
        </div>

            </div>

            <div class="tab-pane" id="temp_eta_settings_tab_cooldown">

        <div class="control-group">
            <label class="control-label" for="temp_eta_enable_cooldown_eta">{{ _('Enable cool-down ETA') }}</label>
            <div class="controls">
                <input type="checkbox" id="temp_eta_enable_cooldown_eta"
                       data-bind="checked: settings.plugins.temp_eta.enable_cooldown_eta, enable: settings.plugins.temp_eta.enabled">
                <p class="help-block">{{ _('Show an estimated time to cool down when no target temperature is set.') }}</p>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="temp_eta_cooldown_mode">{{ _('Cool-down mode') }}</label>
            <div class="controls">
                <select class="input-xlarge" id="temp_eta_cooldown_mode"
                        data-bind="value: settings.plugins.temp_eta.cooldown_mode, enable: settings.plugins.temp_eta.enabled && settings.plugins.temp_eta.enable_cooldown_eta">
                    <option value="threshold">{{ _('Threshold target (default)') }}</option>
                    <option value="ambient">{{ _('Ambient-based target') }}</option>
                </select>
                <p class="help-block">{{ _('Threshold: cool down to a fixed target per heater. Ambient: cool down close to ambient temperature (uses an ambient value if set, otherwise estimates from recent data).') }}</p>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="temp_eta_cooldown_target_tool0">{{ _('Cool-down target (tool0)') }}</label>
            <div class="controls">
                <input type="number" class="input-small" id="temp_eta_cooldown_target_tool0"
                       data-bind="value: settings.plugins.temp_eta.cooldown_target_tool0, enable: settings.plugins.temp_eta.enabled && settings.plugins.temp_eta.enable_cooldown_eta && settings.plugins.temp_eta.cooldown_mode() === 'threshold'"
                       min="0" max="400" step="1">
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="temp_eta_cooldown_target_bed">{{ _('Cool-down target (bed)') }}</label>
            <div class="controls">
                <input type="number" class="input-small" id="temp_eta_cooldown_target_bed"
                       data-bind="value: settings.plugins.temp_eta.cooldown_target_bed, enable: settings.plugins.temp_eta.enabled && settings.plugins.temp_eta.enable_cooldown_eta && settings.plugins.temp_eta.cooldown_mode() === 'threshold'"
                       min="0" max="200" step="1">
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="temp_eta_cooldown_target_chamber">{{ _('Cool-down target (chamber)') }}</label>
            <div class="controls">
                <input type="number" class="input-small" id="temp_eta_cooldown_target_chamber"
                       data-bind="value: settings.plugins.temp_eta.cooldown_target_chamber, enable: settings.plugins.temp_eta.enabled && settings.plugins.temp_eta.enable_cooldown_eta && settings.plugins.temp_eta.cooldown_mode() === 'threshold'"
                       min="0" max="100" step="1">
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="temp_eta_cooldown_ambient_temp">{{ _('Ambient temperature (optional)') }}</label>
            <div class="controls">
                <input type="number" class="input-small" id="temp_eta_cooldown_ambient_temp"
                       data-bind="value: settings.plugins.temp_eta.cooldown_ambient_temp, enable: settings.plugins.temp_eta.enabled && settings.plugins.temp_eta.enable_cooldown_eta && settings.plugins.temp_eta.cooldown_mode() === 'ambient'"
                       min="-20" max="80" step="0.5">
                <p class="help-block">{{ _('If empty, the plugin estimates ambient temperature from recent cooldown data.') }}</p>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="temp_eta_cooldown_hysteresis_c">{{ _('Cool-down hysteresis (°C)') }}</label>
            <div class="controls">
                <input type="number" class="input-small" id="temp_eta_cooldown_hysteresis_c"
                       data-bind="value: settings.plugins.temp_eta.cooldown_hysteresis_c, enable: settings.plugins.temp_eta.enabled && settings.plugins.temp_eta.enable_cooldown_eta"
                       min="0.1" max="20" step="0.1">
                <p class="help-block">{{ _('Stop showing Cool-down ETA when within this temperature band of the cool-down target.') }}</p>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="temp_eta_cooldown_fit_window_seconds">{{ _('Cool-down fit window (seconds)') }}</label>
            <div class="controls">
                <input type="number" class="input-small" id="temp_eta_cooldown_fit_window_seconds"
                       data-bind="value: settings.plugins.temp_eta.cooldown_fit_window_seconds, enable: settings.plugins.temp_eta.enabled && settings.plugins.temp_eta.enable_cooldown_eta"
                       min="10" max="1800" step="10">
                <p class="help-block">{{ _('How many seconds of recent cooldown data to use for the ETA estimate.') }}</p>
            </div>
        </div>

            </div>

            <div class="tab-pane" id="temp_eta_settings_tab_advanced">

        <!-- Update Interval -->
        <div class="control-group">
            <label class="control-label" for="temp_eta_update_interval">{{ _('Update Interval (seconds)') }}</label>
            <div class="controls">
                <input type="number" class="input-small" id="temp_eta_update_interval"
                       data-bind="value: settings.plugins.temp_eta.update_interval"
                       min="0.1" max="5" step="0.1">
                <p class="help-block">{{ _('How often to update ETA display (lower = more responsive, higher = less CPU)') }}</p>
            </div>
        </div>

        <!-- History Size -->
        <div class="control-group">
            <label class="control-label" for="temp_eta_history_size">{{ _('Temperature History Size') }}</label>
            <div class="controls">
                <input type="number" class="input-small" id="temp_eta_history_size"
                       data-bind="value: settings.plugins.temp_eta.history_size"
                       min="10" max="300" step="10">
                <p class="help-block">{{ _('Number of temperature samples to keep in history') }}</p>
            </div>
        </div>

        <!-- Debug Logging -->
        <div class="control-group">
            <label class="control-label" for="temp_eta_debug_logging">{{ _('Enable debug logging') }}</label>
            <div class="controls">
                <input type="checkbox" id="temp_eta_debug_logging" data-bind="checked: settings.plugins.temp_eta.debug_logging">
                <p class="help-block">{{ _('Write additional debug information to the OctoPrint log (may be noisy)') }}</p>
            </div>
        </div>

            </div>

            <div class="tab-pane" id="temp_eta_settings_tab_maintenance">

        <!-- Reset Profile History -->
        <div class="control-group">
            <label class="control-label" for="temp_eta_reset_profile_history">{{ _('Reset profile history') }}</label>
            <div class="controls">
                <button type="button" class="btn btn-danger" id="temp_eta_reset_profile_history" data-bind="enable: isAdmin"
                        data-notify-title="{{ _('Temperature ETA') }}"
                        data-confirm-title="{{ _('Confirm reset') }}"
                        data-confirm-text="{{ _('Really delete all persisted ETA history JSON files for all printer profiles?') }}"
                        data-success-title="{{ _('Temperature ETA') }}"
                        data-success-text-generic="{{ _('History reset completed.') }}"
                        data-success-text-with-count="{{ _('Deleted persisted history for all profiles ({count} file(s)).') }}"
                        data-success-text-none="{{ _('No persisted history files found.') }}"
                        data-error-title="{{ _('Temperature ETA') }}"
                        data-error-text="{{ _('Reset failed.') }}"
                        data-error-no-api="{{ _('OctoPrint API not available.') }}">
                    {{ _('Reset') }}
                </button>
                <p class="help-block">
                    {{ _("Deletes all persisted ETA history JSON files for all printer profiles (stored in OctoPrint's plugin data folder).") }}
                </p>
            </div>
        </div>

        <!-- Restore Defaults -->
        <div class="control-group">
            <label class="control-label" for="temp_eta_restore_defaults">{{ _('Restore defaults') }}</label>
            <div class="controls">
                <button type="button" class="btn btn-warning" id="temp_eta_restore_defaults" data-bind="enable: isAdmin"
                        data-notify-title="{{ _('Temperature ETA') }}"
                        data-confirm-title="{{ _('Confirm reset') }}"
                        data-confirm-text="{{ _('Restore all Temperature ETA settings to their default values?') }}"
                        data-success-title="{{ _('Temperature ETA') }}"
                        data-success-text="{{ _('Defaults restored.') }}"
                        data-error-title="{{ _('Temperature ETA') }}"
                        data-error-text="{{ _('Restore defaults failed.') }}"
                        data-error-no-api="{{ _('OctoPrint API not available.') }}">
                    {{ _('Restore') }}
                </button>
                <p class="help-block">{{ _('Restores Temperature ETA settings to their default values.') }}</p>
            </div>
        </div>

            </div>
        </div>
    </fieldset>
</form>

<div class="panel panel-info">
    <div class="panel-heading">
        <h4 class="panel-title">
            <i class="fa fa-info-circle"></i> {{ _('How it works') }}
        </h4>
    </div>
    <div class="panel-body">
        <ul>
            <li>{{ _('Monitors temperature changes in real-time') }}</li>
            <li>{{ _('Calculates heating rate (°C/second)') }}</li>
            <li>{{ _('Estimates time to reach target temperature') }}</li>
            <li>{{ _('Displays countdown in MM:SS format') }}</li>
        </ul>
        <p>
            <small>{{ _('Adjust the algorithm, threshold, and polling interval above to tune the ETA calculation for your printer.') }}</small>
        </p>
    </div>
</div>
